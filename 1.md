---
title: Função SUB - Chamada de Subprograma
type: docs
weight: 1
---

# 1 - Descrição e Conceitos
A função "SUB" possibilita a execução de um subprograma.
## 1.1 - Subprograma Cobol Reentrante
 Os módulos utilizados como subprograma cobol e reentrante devem ter a especificação de LOC=ACIMA na sua entrada da MTMO.
## 1.2 - Subprograma em "C"
Os subprogramas codificados em "C" devem ser especificados na MTMO com LOC=ACIMA, ATRIB=RENT e LING=C. Além disto, devem seguir as seguintes considerações.
+ Devem ser linkeditados com os parâmetros RENT e RMODE(ANY); além disto, devem passar por um step de pré-linkedição para poderem ser reentrantes. Estas considerações são satisfeitas pela PROC "RENTC" ou pela CLIST "XCAT".
+ O subprograma receberá os parâmetros no formato:
**(int argc, char \* argv[] )**
+ Um subprograma em "C" pode chamar a ponte MONITOR para executar qualquer função normalmente, inclusive chamar outro subprograma codificado em "C" ou em outra linguagem. Veja no item 4 um exemplo de chamada.
+ Os displays sem um destino específico são direcionados para o arquivo SYSPRINT. Usar displays apenas para testes, a fim de não degradar a performance do GRBE em produção.
# 2 - Descrição dos Parâmetros
## 2.1 Primeiro Parâmetro
| **3 bytes** | Função da PONTE MONITOR que está sendo solicitada: "SUB" |
| --- | --- |
| **1 byte** | Código de retorno da PONTE MONITOR. |
| **8 bytes** | Nome da entidade que tratará a função: "GRBE". |
## 2.2 Segundo Parâmetro
| **3 bytes** | Função a ser processada: "EXE". |
| --- | --- |
| **1 byte** | Código de retorno da função "SUB". |
| **8 bytes** | Nome do subprograma a ser executado (deve estar na MTSP). |
## 2.3 Demais Parâmetros
Os próximos argumentos são os que serão usados diretamente pelo subprograma a ser chamado, portanto deverão obedecer as especificações dadas na circular sobre o referido subprograma.
# 3 - Códigos de Retorno
 O código de retorno da função virá no quarto byte do segundo parâmetro.
 Este poderá conter os seguintes valores quando o programa retomar o controle após a chamada desta ponte.
| Código de Retorno | Descrição |
| --- | --- |
| **A** | Função executada sem erros. |
| **M** | O subprograma chamado não está catalogado. |
| **N** | O subprograma foi catalogado indevidamente, ou seja, todo subprograma Cobol reentrante deve ser catalogado com AMODE acima dos 16 Mb. |
| **V** | O subprograma chamado está inativo ou a carga dos subprogramas ainda não terminou (neste último caso a execução se normaliza assim que a inicialização do GRBE terminar). |
| **Y** | A MTSP não foi encontrada. |
**Observação**
1. No primeiro parâmetro está o código de retorno da ponte "MONITOR" informando o status de processamento da ponte.
2. Os códigos acima retornam no segundo parâmetro.
# 4 - Exemplo
Exemplo de utilização da função XXX
 ## Cobol
```
A       B
         .
         .
         .
 DATA   DIVISION
  01     WMONIT
         03 WFPTE                    PIC X(3) VALUE 'SUB'.
         03 WRET-COD-MONIT           PIC X.
         03 WENTID                   PIC X(8) VALUE 'GRBE'.
  01     WINFP
         03 WEXEC                    PIC X(3) VALUE 'EXE'.
         03 WRET-COD-FUN             PIC X.
         03 WSUB-PROG                PIC X(8) VALUE 'MDATA6'.
  01     WDTDIA                      PIC X(6).
         .
         .
         .
  PROCEDURE DIVISION
         CALL  'MONITOR'  USING WMONIT WFINP WDTDIA.
         IF WRET-COD-MONIT= 'A'
                a ponte MONITOR executou sem erros
            ELSE
                houve erro no processamento da ponte MONITOR
         IF WRET-COD-FUN= 'A'
                 a função solicitada executou sem erros
            ELSE
                 houve erro no processamento da função.
            .
            .
```
## Linguagem C
Dá display do número de parâmetros e do primeiro parâmetro recebido, chama o subprograma MDATA6 através da ponte "MONITOR" e dá display dos RC's da ponte.
```
/**************************************************************/
  /*  os #pragmas abaixo são necessários para estabelecer a     */
  /*  convenção de passagem de parâmetros:                      */
  /**************************************************************/
#pragma runopts(PLIST(MVS))         /* recebe param 'estilo' MVS*/
#pragma linkage(monitor, OS)        /* passa  param 'estilo' MVS*/
  /*  definição do protótipo da ponte MONITOR:                  */
void  monitor();                    /* ponte monitor com num e  */
                                    /*    tipo de param indefin.*/
  /*  primeiro parâmetro para a ponte MONITOR:                  */
struct pmon1                        /* param 1 para ponte:      */
{                                   /*                          */
char fun??(3??) ;                   /*  -funcao                 */
char rc         ;                   /*  -rc                     */
char ent??(8??) ;                   /*  -entidade               */
} p1;                               /*                          */
  /*  segundo  parâmetro para a ponte MONITOR:                  */
struct pmon2                        /* param 2 para ponte:      */
{                                   /*                          */
char fun??(3??);                    /* funcao                   */
char rc         ;                   /* rc                       */
char spg??(8??) ;                   /* nome do spg              */
} p2;                               /*                          */
  /*  parametro para o subpgm, c/ 1 byte a mais p/ low-value:   */
char dia??(7??)                     /*                          */
      .
      .
      .
main(int argc,char * argv ??(??) )         /* inicio            */
{
  /*  da display do num de param. e do param. 1:                */
   printf("Recebeu %d parametros:",argc);   /* displ. num param */
   printf("\nParametro 1 = %s",argv??(1??)) /* displ. param. 1  */
      .
      .
      .
  /*  inicializa parametros para a ponte monitor:               */
   strcpy(p1.fun,"SUB")  ;                 /* funcao SUB        */
   p1.rc = ' '  ;                          /* limpa rc          */
   strcpy(p1.ent,"GRBE")  ;                /* entidade GRBE     */
   strcpy(p2.fun,"EXE")  ;                 /* funcao EXE        */
   p2.rc = ' '  ;                          /* limpa rc          */
   strcpy(p2.spg,"MDATA6  ") ;             /* nome do MDATA6    */
      .                                    /*                   */
  /*  chama a ponte monitor:               /*                   */
   monitor(&p1,&p2,p3);                    /* chama pnte monitor*/
      .                                    /*                   */
  /*  da display dos ret. code:            /*                   */
   printf("\nRC = %c - %c",p1.rc,p2.rc);   /* displ. rc         */
      .                                    /*                   */
      .                                    /*                   */
      .                                    /*                   */
   return(0);                              /* retorna           */
}
```
## 4.1 - Chamada Antiga
#### Primeiro Parâmetro
 Campo zonado de doze bytes no mínimo; com as seguintes informações, nesta ordem.
| **3 bytes** | Função solicitada: "**SUB**"Indica que um subprograma será chamado. |
| --- | --- |
| **1 byte** | Código de retorno da PONTE MONITOR. |
| **8 bytes** | O nome do subprograma a ser chamado quando função "SUB". |
#### Outros Parâmetros
 Os próximos argumentos são os que serão usados diretamente pelo subprograma a ser chamado, portanto deverão obedecer as especificações dadas na circular sobre o referido subprograma.
### Exemplos da Chamada Antiga
#### Exemplo COBOL
 Chama o subprograma MDATA6 através da ponte "MONITOR".
```
 A       B
         .
         .
         .
  DATA   DIVISION
  01     WINFP
         03 WEXEC                    PIC X(3) VALUE 'SUB'.
         03 WRET-COD                 PIC X.
         03 WSUB-PROG                PIC X(8) VALUE 'MDATA6'.
  01     WDTDIA                      PIC X(6).
         .
         .
         .
  PROCEDURE DIVISION
         CALL  'MONITOR'  USING WFINP WDTDIA.
         IF WRET-COD= 'A'
                a ponte MONITOR executou sem erros
            ELSE
                houve erro no processamento da ponte MONITOR
            .
            .
            .
```
#### Exemplo PL/I
 Chama o subprograma MDIFDIA através da ponte MONITOR.
```
   .
   .
   .
DCL     01        WINFP,
                  03   WEXEC          CHAR(3)    INIT('SUB')
                  03   WRET-COD       CHAR(1),
                  03   WSUB-PROG      CHAR(8)    INIT('MDIADIF),.
DCL     WDIFD                         DECIMAL FIXED (5),
        WDATH                         PIC '(6)9',
        WDATF                         PIC '(6)9',
   .
   .
   .
CALL   MONITOR   (WINFP, WDATH, WDATF, WDIFD),.
IF     WRET_COD= 'A'
THEN
    a ponte MONITOR executou sem erros
ELSE
    houve erro no processamento da ponte MONITOR
   ...
   .
```