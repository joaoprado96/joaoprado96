 ---
title: Função FMT - Formatação
type: docs
weight: 1
---

# Índice
1. [Introdução](#introdução)
2. [Objetivos da Formatação](#objetivos-da-formatação)
3. [Tipos de Formato](#tipos-de-formato)
4. [Multi-sistemas](#multi-sistemas)
5. [Mensagem Comprimida](#mensagem-comprimida)
6. [Mensagem Expandida](#mensagem-expandida)
7. [Utilização](#utilização)
8. [Layout](#layout)
9. [Tabela de Nomes e Formatos (MTNF)](#tabela-de-nomes-e-formatos-mtnf)
10. [Opções Disponíveis](#opções-disponíveis)
11. [Descrição dos Parâmetros](#descrição-dos-parâmetros)
12. [Códigos de Retorno](#códigos-de-retorno)
13. [Exemplos](#exemplos)
14. [Glossário](#glossário)

# Introdução
O GRBE disponibiliza ferramentas para realizar a formatação das mensagens trocadas entre os canais e os programas aplicativos. O processo de formatação consiste na transformação de dados de uma forma comprimida (que minimiza a transmissão de dados) para uma forma expandida e vice-versa.

# Objetivos da Formatação
- Diminuir o tamanho dos dados transmitidos, através da eliminação de campos omitidos ou caracteres sem significância.
- Padronizar a forma de comunicação dos aplicativos com os vários canais.
- Simplificar o desenvolvimento das transações sob GRBE através da utilização de ferramentas para manipular as mensagens formatadas.

# Tipos de Formato
Os formatos de mensagens são divididos em três tipos:
- **INPUT**: Formatos recebidos pelas aplicações no GRBE dos canais (terminais etc.).
- **OUTPUT**: Formatos enviados pelas aplicações no GRBE para os canais (respostas).
- **SISTEMA**: Formatos utilizados na comunicação entre aplicações. Não são utilizados pelos canais.

# Multi-sistemas
Em virtude da utilização do GRBE em diferentes ambientes, foram introduzidos novos controles no processo de formatação para permitir maior independência entre os diversos ambientes, garantindo a compatibilidade com a utilização convencional já feita pelas aplicações.

# Mensagem Comprimida
As mensagens transmitidas (comprimidas) são divididas em formatos que, por sua vez, estão divididos em campos. O código de cada formato faz parte da mensagem, precedendo os seus campos. Os formatos são agrupados sempre que há repetições sucessivas, e o número de repetições é informado na mensagem junto com o código do formato.

# Mensagem Expandida
A mensagem expandida deve ser uniforme, não importando como os dados foram transmitidos. Portanto, o formato expandido é composto de campos com tamanho fixo. Na transformação do formato comprimido para o expandido, um campo pode ser truncado ou completado com o caractere de preenchimento, conforme solicitado na tabela de formatos.

# Utilização
A conversão de uma mensagem comprimida para expandida e vice-versa não é feita automaticamente pelo GRBE. O aplicativo deve utilizar a função “FMT” da Ponte MONITOR para extrair (“expandir”) as informações necessárias para a sua Área de Trabalho. Da mesma forma, ao terminar o processamento, o aplicativo deve montar a resposta “comprimida” na sua Área de Saída.

# Layout
Numa mensagem comprimida, um formato se apresenta com o seguinte layout:
| Formato **FF** | 1ª repetição | 2ª repetição | nª repetição | |
| --- | --- | --- | --- | --- |
| ~**FF**rr@ | campo1@...campon@ | campo1@...campon@ | ...campo1@...campon@ | **¬** |

# Tabela de Nomes e Formatos (MTNF)
O processo de formatação utiliza uma tabela com especificações dos nomes e características de campos e dos formatos, a MTNF (Tabela de Nomes e Formatos). Esta tabela é composta de 4 sub-tabelas, cada uma gerada com uma macro específica:
- **MTBNCPvv**: Gera tabela de Nomes de Campos.
- **MTBFMIvv**: Gera tabela de Formatos de tipo Input.
- **MTBFMOvv**: Gera tabela de Formatos de tipo Output.
- **MTBFMSvv**: Gera tabela de Formatos de tipo Sistema.

# Opções Disponíveis
Com a utilização da função “FMT” da Ponte Monitor, o aplicativo pode realizar diversas operações para manipular o conteúdo de mensagens com múltiplos formatos, além da simples expansão e compressão de mensagens. As funções disponíveis incluem:
- **CPS - Compressão**
- **CRP - Compressão Repetida**
- **DPC - Descompressão Padrão CICS**
- **ESC - Expansão com Seleção de Campo**
- **ESL - Expansão sem Literal**
- **EXM - Expansão Múltipla**
- **ESP - Expansão sem Preenchimento**
- **EXP - Expansão**
- **MCF - Movimentação com Conversão de Formatos**
- **MEX - Movimentação com Exclusão de Formato**
- **MFE - Movimentação de Formato Específico**
- **MFN - Movimentação de uma ocorrência de Formato (Next)**
- **MGL - Movimentação Geral**
- **MRP - Movimentação Agrupando Repetições**
- **XAT – Conversão de Multiformatos para XML “Light”**
- **XML – Conversão de Multiformatos para XML**

# Descrição dos Parâmetros
## Primeiro Parâmetro
Parâmetros da ponte "MONITOR".
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 3 | alfanumérico | Função: **"FMT"** |
| 4 | 1 | alfanumérico | Return Code da ponte |
| 5 | 8 | alfanumérico | Entidade (fixo: "**GRBE**") |

## Segundo Parâmetro
Opção e Return code.
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 3 | alfanumérico | Opção (função) da chamada: **"CPS"**, **"CRP"**, **"DPC"**, **"ESC"**, **"ESL"**, **"ESP"**, **"EXM"**, **"EXP"**, **"MCF"**, **"MEX"**, **"MFE"**, **"MFN"**, **"MGL"**, **"MRP"**, **"XAT"**, **"XML"** |
| 4 | 1 | alfanumérico | Return Code da função (Ver Item 3 – Códigos de Retorno) |
| 5 | 8 | alfanumérico | Tipo de formatação: **" "**, **"1"**, **"1X"**, **"1 PADRAO"**, **"1 TERMXX"**, **"2"** |

## Terceiro Parâmetro
Parâmetros de entrada da função.
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 2 | binário | Tamanho máximo da área de entrada (parâmetro 5) |
| 3 | 2 | binário | Tamanho máximo da área de saída (parâmetro 6) |
| 5 | 2 | alfanumérico | Código do formato comprimido (veja observações 1) |
| 7 | 1 | alfanumérico | Tipo do formato comprimido (I, O ou S) (veja observação 1) |
| 8 | 2 | alfanumérico | Código do formato expandido |
| 10 | 1 | alfanumérico | Tipo do formato expandido (I, O ou S) (veja observação 1) |
| 11 | 2 | binário | Número de repetições |
| 13 | 2 | binário | Deslocamento na área de entrada (veja observação 2) |
| 15 | 2 | binário | Deslocamento na área de saída (veja observação 2) |
| 17 | 3 | alfanumérico | Nome do sistema no formato comprimido (veja observação 2) |
| 20 | 1 | alfanumérico | Grupo do sistema no formato comprimido (veja observação 5) |
| 21 | 3 | alfanumérico | Nome do sistema no formato expandido (veja observação 2) |
| 24 | 1 | alfanumérico | Grupo do sistema no formato expandido (veja observação 2) |
| 25 | 15 | alfanumérico | Relação de até 5 formatos/tipos a serem convertidos pela função MCF. Devem ser fornecidos pares "formato-tipo" ou brancos |

## Quarto Parâmetro
Parâmetros de retorno da função (veja observação 5).
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 2 | alfanumérico | Código de formato comprimido efetuado |
| 3 | 1 | alfanumérico | Tipo de formato comprimido efetuado (I, O ou S) |
| 4 | 2 | alfanumérico | Código do formato expandido efetuado |
| 6 | 1 | alfanumérico | Tipo de formato expandido efetuado (I, O ou S) |
| 7 | 2 | binário | Número de repetições efetuadas |
| 9 | 2 | binário | Deslocamento na área de entrada - retorno (veja observação 2) |
| 11 | 2 | binário | Deslocamento na área de saída - retorno (veja observação 2) |
| 13 | 3 | alfanumérico | Nome do sistema no formato comprimido (veja observação 2) |
| 16 | 1 | alfanumérico | Grupo do sistema no formato comprimido (veja observação 2) |
| 17 | 3 | alfanumérico | Nome do sistema no formato expandido (veja observação 2) |
| 20 | 1 | alfanumérico | Grupo do sistema no formato expandido (veja observação 2) |

## Quinto Parâmetro
Área da mensagem de entrada.
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | N | variado | Mensagem a processar (veja observação 4) |

## Sexto Parâmetro
Área da mensagem de saída.
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | N | variado | Mensagem após processamento |

### Observações
1. Se a opção solicitada for "EXP", "ESL", "ESP", "MEX", "MFE" ou "MFN" e for passado “brancos” no código ou tipo de formato comprimido, será expandido ou movido o primeiro formato comprimido encontrado e o código/tipo de formato efetuado será retornado no parâmetro 4.
2. Tamanho dos campos já processados. Na primeira chamada para determinada mensagem, deve ser zero, e nas demais chamadas deve ser passado o valor retornado no quarto parâmetro pela chamada anterior (refere-se ao processamento da mensagem comprimida - param 5).
3. Tamanho Máximo da mensagem expandida. No caso de compressão para envio ao terminal, este valor deverá ser o do tamanho do buffer do terminal.
4. Este parâmetro sempre se refere ao início da área, não importando se é o primeiro formato ou não.
5. Campo não utilizado na Opção DPC.
6. Na função ESC a área de saída deve conter o caractere # na primeira posição de cada campo que se quer expandir.

### Tabela de Relação Função x Parâmetros
| 3º. Parâmetro (entrada) | ESC | ESL | ESP | EXP | EXM | CPS | CRP | MGL | MEX | MFE | MFN | DPC | MCF | MRP | XAT | XML |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Tamanho máximo área entrada | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim |
| Tamanho máximo área saída | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim | sim |
| Código formato comprimido | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Tipo formato comprimido | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Código formato expandido | sim | sim | sim | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Tipo formato expandido | sim | sim | sim | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Número de repetições | sim | - | sim | - | - | - | sim | - | - | - | sim | - | - | - | - | - |
| Deslocamento área entrada | sim | sim | - | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Deslocamento área saída | - | - | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Nome do sistema do formato comprimido | sim | sim | sim | - | sim | - | - | - | - | - | - | - | - | - | - | - |
| Grupo do sistema do formato comprimido | sim | sim | sim | - | sim | - | - | - | - | - | - | - | - | - | - | - |
| Nome do sistema do formato expandido | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Grupo do sistema do formato expandido | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Lista de Formatos/Tipos | - | - | - | - | - | - | sim | - | - | - | - | - | - | - | - | - |

### 4º. Parâmetro (retorno)
| 4º. Parâmetro (retorno) | ESC | ESL | ESP | EXP | EXM | CPS | CRP | MGL | MEX | MFE | MFN | DPC | MCF | MRP | XAT | XML |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Código formato comprimido | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Tipo formato comprimido | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Código formato expandido | sim | sim | sim | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Tipo formato expandido | sim | sim | sim | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Número de repetições | sim | - | sim | - | - | - | sim | - | - | - | sim | - | - | - | - | - |
| Deslocamento área entrada | sim | sim | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Deslocamento área saída | sim | sim | sim | sim | sim | - | sim | - | sim | - | sim | - | sim | - | sim | - |
| Nome do sistema do formato comprimido | sim | sim | sim | - | sim | - | sim | - | - | - | - | - | - | - | - | - |
| Grupo do sistema do formato comprimido | sim | sim | sim | - | sim | - | sim | - | - | - | - | - | - | - | - | - |
| Nome do sistema do formato expandido | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Grupo do sistema do formato expandido | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - | - |

# Códigos de Retorno
| Código de Retorno | Descrição |
| --- | --- |
| **A** | **Processamento Normal.** Foi completado o processamento solicitado com sucesso. |
| **B** | **Estouro na Área de Entrada.** O tamanho da área de entrada foi atingido e não foi concluído o processamento solicitado. Se alguma repetição foi completada, é informado no parâmetro 4 o número de repetições concluídas. |
| **C** | **Estouro na Área de Saída.** O tamanho da área de saída foi atingido e não foi concluído o processamento solicitado. Se alguma repetição foi completada, é informado no parâmetro 4 o número de repetições concluídas. |
| **D** | **Caractere de fim de mensagem comprimida atingida.** O caractere de fim de mensagem comprimida "¬" foi atingido e não foi concluído o processamento solicitado. Se alguma repetição foi completada, é informado no parâmetro 4 o número de repetições concluídas. **Falta definir o campo DESC na MTNF** Para as opções “XAT” e “XML” está faltando a definição do campo DESC na tabela MTNF. |
| **E** | **Opção Inválida.** 