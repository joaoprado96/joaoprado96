---
title: Função FMT - Formatação
type: docs
weight: 1
---

# 1 - Descrição e Conceitos
### 1.1 Objetivos da Formatação
O GRBE disponibiliza ferramentas para realizar a formatação das mensagens trocadas entre os canais e os programas aplicativos com o objetivo de:
+ Diminuir o tamanho dos dados transmitidos, através da eliminação de campos omitidos ou caracteres sem significância.
+ Padronizar a forma de comunicação dos aplicativos com os vários canais.
+ Simplificar o desenvolvimento das transações sob GRBE através da utilização de ferramentas para manipular as mensagens formatadas.
O processo de formatação consiste na transformação de dados de uma forma comprimida (que minimiza a transmissão de dados) para uma forma expandida e vice-versa.
Abaixo um exemplo de mensagem (comprimida) composta de formatos múltiplos:
![](/download/attachments/397200046/image2020-4-16_17-31-30.png?version=1&modificationDate=1587070465000&api=v2)
Na utilização dos Formatos Múltiplos o código do formato presente no header da mensagem, ou fornecido pelo programa aplicativo na área de comunicação com o GRBE (LPARAM4-FORMA), deve ter o valor fixo “00”.
### 1.2 Introdução
O processo de formatação consiste na transformação de dados da forma comprimida (que minimiza a transmissão de dados) para uma forma expandida e vice-versa.
Este processo é comandado pela aplicação sob GRBE através de uma chamada à ponte "MONITOR" e utiliza tabelas com as especificações de cada campo da mensagem e a relação de campos que compõem um determinado formato.
Quando a aplicação monta a resposta ao terminal com este processo, ela deve passar "00" no código de formato na área de comunicação com o GRBE (LPARAM4-FORMA), pois a formatação já está realizada.
### 1.2.1 Tipos de Formato
Os formatos de mensagens são divididos em três tipos:
+ INPUT - são formatos recebidos pelas aplicações no GRBE dos canais (terminais etc.)
+ OUTPUT – são formatos enviados pelas aplicações no GRBE para os canais (respostas)
+ SISTEMA – são formatos utilizados na comunicação entre aplicações. Não são utilizados pelos canais.
O tipo de cada formato é determinado pelo modo como ele é definido na tabela de formatos.
### 1.2.2 Multi-sistemas
Em virtude da utilização do GRBE em diferentes ambientes, foram introduzidos no processo de formatação novos controles visando a permitir maior independência entre os diversos ambientes, permitindo o uso de tabelas separadas, sempre garantindo a compatibilidade com a utilização convencional já feita pelas aplicações.
Estes novos controles são utilizados apenas em formatos do tipo “sistema”, a fim de não gerar incompatibilidade com os canais de comunicação que também utilizam os formatos do tipo “input” e “output”. Caso haja a necessidade de se aumentar a quantidade de formatos de input/output na tabela de formatos, futuramente, eles podem ser expandidos para estes tipos de formato, desde que os canais envolvidos possam ser compatibilizados.
### 1.3 Mensagem Comprimida
As mensagens transmitidas (comprimidas) são divididas em formatos que por sua vez estão divididas em campos.
O código de cada formato faz parte da mensagem, precedendo os seus campos.
Os formatos são agrupados sempre que há repetições sucessivas. O número de repetições é informado na mensagem junto com o código do formato.
Cada campo de um formato recebe a compactação conforme especificado na tabela de formatos, por exemplo: supressão de determinado caractere à direita ou a esquerda etc.
### 1.4 Mensagem Expandida
A mensagem expandida deve ser uniforme, não importando como os dados foram transmitidos, ou seja, não importa qual o formato na mensagem comprimida.
Portanto o formato expandido é composto de campos com tamanho fixo.
Os campos que compõem a mensagem expandida podem ser valores constantes ou dados extraídos de um formato comprimido.
Na transformação do formato comprimido para o expandido um campo pode ser truncado ou completado com o caractere de preenchimento, conforme solicitado na tabela de formatos.
Na mensagem expandida não são utilizados caracteres de controle para separar os campos, ou seja, todos os caracteres presentes são parte dos dados.
### 1.5 Utilização
A conversão de uma mensagem comprimida para expandida e vice-versa não é feita automaticamente pelo GRBE.
Desta forma, a mensagem recebida na Área de Entrada pelo aplicativo é a mesma mensagem comprimida recebida do canal. O aplicativo deve utilizar a função “FMT” da Ponte MONITOR para extrair (“expandir”) as informações que necessida para a sua Área de Trabalho.
Da mesma forma, ao terminar o processamento o aplicativo tem que montar a resposta “comprimida” na sua Área de Saída; esta resposta é enviada ao canal sem maiores transformações.
A definição dos layouts dos formatos utilizados é feita na Tabela de Nomes e Formatos (MTNF). Nesta tabela são feitas as especificações de cada campo da mensagem e a relação de campos que compõem cada formato.
### 1.6 Tipos
Os formatos de mensagens são divididos em três tipos:
+ INPUT - são formatos recebidos pelas aplicações no GRBE dos canais (terminais etc.)
+ OUTPUT – são formatos enviados pelas aplicações no GRBE para os canais (respostas)
+ SISTEMA – são formatos utilizados na comunicação entre aplicações. Não são utilizados pelos canais.
O tipo de cada formato é determinado pelo modo como ele é definido na Tabela de Nomes e Formatos MTNF.
Na mensagem comprimida, o tipo do formato é identificado por um caractere de controle que precede cada formato, comforme a tabela abaixo:
| Caractere | EBCDIC (hexa) | ASCII (hexa) | Função |
| --- | --- | --- | --- |
| **~** | A1 | 7E | Início de formato tipo Output |
| **>** | 6E | 3E | Início de formato tipo Input |
| **!** | 5A | 21 | Início de formato tipo Sistema |
| **@** | 7C | 40 | Separador de campos |
| **¬** | 5F | 5E | Término do texto formatado |
| **?** | 6F | 3F | Indica que próximo caractere não é de controle |
Estes caracteres são utilizados para identificar o início de campos e formatos e o término do texto formatado.
A presença destes caracteres dentro do conteúdo dos campos (e também na mensagem expandida) é permitida. Vale lembrar que neste caso ao serem movidos para a mensagem comprimida eles ficam precedidos por uma interrogação: por exemplo, o texto “SALDO==> “ fica comprimido como “SALDO==?>“ ; por isto a mensagem comprimida pode em alguns casos ficar maior que a expandida.
Em virtude da utilização do GRBE em diferentes ambientes, foram introduzidos no processo de formatação novos controles visando permitir maior independência entre os diversos ambientes, permitindo o uso de tabelas separadas, sempre garantindo a compatibilidade com a utilização convencional já feita pelas aplicações.
Estes novos controles são utilizados apenas em formatos do tipo “sistema”, a fim de não gerar incompatibilidade com os canais de comunicação que também utilizam os formatos do tipo “input” e “output”.
### 1.7 Layout
Numa mensagem comprimida, um formato se apresenta com o seguinte layout:
| Formato **FF** | 1ª repetição | 2ª repetição | nª repetição |  |
| --- | --- | --- | --- | --- |
| ~**FF**rr@ | campo1@...campon@ | campo1@...campon@ | ...campo1@...campon@ | **¬** |
### 1.8 Tabela de nomes e formatos (MTNF)
O processo de formatação utiliza uma tabela com especificações dos nomes e características de campos e dos formatos, a MTNF (Tabela de Nomes e Formatos).
A MTNF a ser utilizada pelo GRBE é passada no PARM de execução, como as demais tabelas.
Esta tabela é composta de 4 sub-tabelas, cada uma gerada com uma macro específica:
+ MTBNCPvv – Gera tabela de Nomes de Campos.
+ MTBFMIvv - Gera tabela de Formatos de tipo Input.
+ MTBFMOvv - Gera tabela de Formatos de tipo Output.
+ MTBFMSvv - Gera tabela de Formatos de tipo Sistema.
Esta estrutura permite que as definições dos campos sejam re-utilizadas por múltiplos formatos, além de fornecer grande flexibilidade para definir a composição dos formatos com conteúdos de diferentes campos ou valores fixos.
### 1.9 Opções disponíveis
Com a utilização da função “FMT” da Ponte Monitor o aplicativo pode realizar diversas operações para manipular o conteúdo de mensagems com múltiplos formatos, além da simples expansão e compressão de mensagens.
O aplicativo pode a qualquer momento extrair apenas o formato que necessida da mensagem, combinar campos de formatos diferentes, acrescentar formatos à mensagem ou manipular a mensagem comprimida selecionando ou excluindo formatos.
A seguir as funções disponíveis:
+ **CPS - Compressão**
Os campos da mensagem expandida são tratados de acordo com as especificações da MTNF e inseridos na mensagem comprimida.
**Multissistemas:** o formato comprimido pode ser de outro sistema, mas o formato expandido tem que ser do sistema onde está sendo executada a transação.
+ **CRP - Compressão Repetida**
Os campos da mensagem expandida são inseridos no final da mensagem comprimida seguindo as especificações da MTNF, desde que o formato solicitado seja o mesmo do último formato comprimido. Neste caso, não é colocado o separador de formatos, em vez disto é incrementado o numero de repetições do já existente (na mensagem comprimida). O número máximo de repetições de um formato não pode ser superior a 99.
**Multissistemas:** o formato comprimido pode ser de outro sistema, mas o formato expandido tem que ser do sistema onde está sendo executada a transação.
+ **DPC - Descompressão Padrão CICS**
A mensagem comprimida pelo CICS (que trabalha com outro formato de compressão, que não é descrito neste documento) é descomprimida para que a aplicação do GRBE possa tratá-la.
**Observação**: As mensagens ISO não são comprimidas.
+ **ESC - Expansão com Seleção de Campo**
É efetuada a expansão somente do(s) campo(s) selecionado(s). O(s) campo(s) selecionado(s) é(são) o(s) identificado(s) na área de saída com "#" na 1ª POSIÇÃO do(s) campo(s). Os demais campos não identificados com "#" permanecem os mesmos, sem sofrer alteração.
*Um exemplo*: se quisermos expandir apenas o terceiro campo de uma mensagem, na área de saída, colocamos na 1ª POSIÇÃO do terceiro campo o caracter "#" (sem as aspas). No caso de expansão de mais campos, coloca-se o "#" na 1ª POSIÇÃO destes campos. Caso o "#" seja colocado na mensagem mas não na 1ª POSIÇÃO de algum campo, o campo não será expandido.
+ **ESL - Expansão sem Literal**
É efetuada a mesma expansão da opção EXP, mas sem a movimentação dos literais especificados na MTNF.
**Multissistemas**: o formato comprimido pode ser de outro sistema, mas o formato expandido tem que ser do sistema onde está sendo executada a transação.
+ **EXM - Expansão Múltipla**
A mensagem comprimida é percorrida para localização de todas as ocorrências do formato solicitado, as quais são expandidas segundo o mesmo processo da expansão normal (EXP). Todos os formatos encontrados serão expandidos sobre a mesma área de saída. Assim, caso um campo ocorra mais de uma vez, será expandido o que estiver por último na mensagem comprimida (mais à direita); do mesmo modo, caso seja selecionado um formato com várias repetições, o resultado da expansão terá o conteúdo da última repetição de cada campo.
Se o tipo de formato comprimido não for especificado (estiver em branco), serão expandidos todos os tipos encontrados com o código de formato solicitado.
**Multissistemas**: o formato comprimido pode ser de outro sistema, mas o formato expandido tem que ser do sistema onde está sendo executada a transação. Caso o sistema do formato comprido não for especificado (estiver em branco), serão expandidos todos os formatos encontrados com o código solicitado, independente do sistema.
+ **ESP - Expansão sem Preenchimento**
É efetuada a mesma expansão da opção EXP, exceto a movimentação dos literais e dos caracteres de preenchimento especificados na MTNF.
+ **EXP - Expansão**
O formato solicitado pela aplicação é localizado na mensagem comprimida e seus campos são colocados na área de mensagem expandida seguindo as especificações da tabela MTNF. Se um campo do formato expandido solicitado não for localizado na mensagem comprimida, ou for localizado mas estiver vazio, será preenchido na área expandida com o caractere de preenchimento especificado na MTNF.
**Multissistemas**: o formato comprimido pode ser de outro sistema, mas o formato expandido tem que ser do sistema onde está sendo executada a transação.
**Importante**: Provisoriamente, o tipo de formato solicitado não está sendo considerado. Assim, será utilizado o primeiro formato encontrado na mensagem comprimida com o código solicitado, independentemente do tipo. Para que o tipo seja considerado deve ser passado “1X” no segundo parâmetro.
+ **MCF - Movimentação com Conversão de Formatos**
Formatos selecionados na área de entrada são usados para formar um novo formato na área de saída. Os campos no novo formato recebem o conteúdo dos campos com mesmo nome encontrados nos formatos de entrada. Campos que ocorrem em mais de um formato selecionado na entrada recebem apenas o primeiro conteúdo encontrado, os demais conteúdos são ignorados.
+ **MEX - Movimentação com Exclusão de Formato**
Todos os formatos de uma mensagem comprimida da área origem são movimentados para uma área destino com exceção do formato especificado.
Se não for especificado nenhum formato, serão movimentados todos os formados encontrados com exceção dos que tiverem o tipo especificado. Se o tipo também não for fornecido, toda a mensagem será movimentada (como no MGL). Se os formatos selecionados tiverem repetições, todas elas são movimentadas.
**Multissistemas**: caso o sistema do formato não for especificado, a seleção dos formato a serem excluidos da movimentação será feita independente do sistema.
+ **MFE - Movimentação de Formato Específico**
É feita a movimentação de todas as ocorrências de um formato solicitado que forem encontradas em uma mensagem comprimida da área de entrada para a área de saída. Se o formato não for especificado (estiver em branco), serão movimentados todos os formatos encontrados com o tipo especificado. Se o tipo também não for fornecido, toda a mensagem será movimentada (como no
MGL).
**Multissistemas**: caso o sistema do formato não for especificado (estiver em branco), serão movimentados todos os formatos encontrados com o tipo/código especificados, independente do sistema.
**Importante**: Provisoriamente, o tipo de formato solicitado não está sendo considerado. Assim, serão movimentados todos os formatos encontrados com o código solicitado, independentemente do tipo. Para que o tipo seja considerado deve ser passado “1X” no segundo parâmetro.
+ **MFN - Movimentação de uma ocorrência de Formato (Next)**
É feita a movimentação apenas da próxima ocorrência de um formato solicitado de uma mensagem comprimida na área de entrada para a área de saída. Se o formato não for especificado (estiver em branco), será movimentado o primeiro formato encontrado na entrada com o tipo especificado. Se o tipo também não for fornecido, será movimentado o primeiro formato encontrado. Se o formato
encontrado tiver repetições, todas elas são movimentadas.
**Multissistemas**: caso o sistema do formato não for especificado, a próxima ocorrência do formato com o tipo/código desejado será movimentada, independente do sistema.
+ **MGL - Movimentação Geral**
A mensagem comprimida passada na área de entrada é simplesmente movimentada para a área de saída, com todos os formatos. Não é efetuado nenhum tratamento, portanto o resultado será uma mensagem comprimida idêntica à original.
+ **MRP - Movimentação Agrupando Repetições**
Está opção irá verificar a mensagem comprimida passada na área de entrada e efetuará o agrupamento dos formatos idênticos, retirando as repetições e o resultado será movimentado para a área de saída.
+ **XAT – Conversão de Multiformatos para XML “Light”**
Esta opção não é disponibilizado para utilização para aplicação. Possui o mesmo tratamento da opção XML com alguma particularidade, e é utilizado somente pelo GRBE.
+ **XML – Conversão de Multiformatos para XML**
A mensagem comprimida, formatada conforme solicitado pela aplicação e de acordo com as definições na MTNF, é transformada para XML. O padrão de XML utilizado é: Elemento Pai (formato) e elementos filhos (campos).
# 2 - Descrição dos Parâmetros
## 2.1 Primeiro Parâmetro
Parâmetros da ponte "MONITOR".
| Pos. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 3 | alfanumérico | Função: **"FMT**" |
| 4 | 1 | alfanumérico | Return Code da ponte |
| 5 | 8 | alfanumérico | Entidade (fixo: "**GRBE**") |
## 2.2 Segundo Parâmetro
Opção e Return code.
| Pos.. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 3 | alfanumérico | Opção (função) da chamada:* "**CPS**" = ComPreSsão * "**CRP**" = Compressão de RePetição * "**DPC**" = Descompressão Padrão Cics * **“ESC”** = Expansão Somente do Campo * **“ESL**" = Expansão Sem Literal * **“ESP”** = Expansão Sem Preenchimento * "**EXM**" = EXpansão de Múltiplos formatos * "**EXP**" = EXPansão * **“MCF”** = Movimentação com Conversão de Formatos * "**MEX**" = Movimentação com EXclusão de formato * "**MFE**" = Movimentação de Formato Especifico * "**MFN**" = Movimentação de uma ocorrência de Formato (Next) * "**MGL**" = Movimentação GeraL * **“MRP”** = Movimentação Agrupando Repetições * **“XAT”** = Conversão de Multiformatos para XML“Ligth” * **“XML”** = Conversão de Multiformatos para XML |
| 4 | 1 | alfanumérico | Return Code da função (Ver Item 3 – Códigos de Retorno) |
| 5 | 8 | alfanumérico | Tipo de formatação:* " " = trata apenas formatos de tipo OUTPUT (antiga). * "**1**" = trata formatos de tipo INPUT, OUTPUT e SISTEMA, mas ignora o tipo pedido pela aplicação nas funções EXM, MFE e MFN. No caso da função XAT, é tratado como uma mensagem XML sem cabeçalho. * **“1X”** = igual a formatação **“1”**, sem ignorar o tipo pedido pela aplicação. * "**1 PADRAO**" = usado apenas para funções XML ou XAT que usem como cabeçalho padrão da mensagem XML. * "**1 TERMXX**" = usado apenas para funções XML ou XAT que usem como cabeçalho especifico da mensagem XML, onde XX é a identificação do terminal, podendo ser 06, 27 ou 71. * "**2**" = trata formatação multisistemas. |
## 2.3 Terceiro Parâmetro
Parâmetros de entrada da função.
| Pos.. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 2 | binário | Tamanho máximo da área de entrada (parâmetro 5) |
| 3 | 2 | binário | Tamanho máximo da área de saída (parâmetro 6) |
| 5 | 2 | alfanumérico | Código do formato comprimido (veja observações 1) |
| 7 | 1 | alfanumérico | Tipo do formato comprimido (I, O ou S) (veja observação 1) |
| 8 | 2 | alfanumérico | Código do formato expandido |
| 10 | 1 | alfanumérico | Tipo do formato expandido (I, O ou S) (veja observação 1) |
| 11 | 2 | binário | Número de repetições |
| 13 | 2 | binário | Deslocamento na área de entrada (veja observação 2) |
| 15 | 2 | binário | Deslocamento na área de saída (veja observação 2) |
| 17 | 3 | alfanumérico | Nome do sistema no formato comprimido (veja observação 2) |
| 20 | 1 | alfanumérico | Grupo do sistema no formato comprimido (veja observação 5) |
| 21 | 3 | alfanumérico | Nome do sistema no formato expandido (veja observação 2) |
| 24 | 1 | alfanumérico | Grupo do sistema no formato expandido (veja observação 2) |
| 25 | 15 | alfanumérico | Relação de até 5 formatos/tipos a serem convertidos pela função MCF Devem ser fornecidos pares "formato-tipo" ou brancos |
## 2.4 Quarto Parâmetro
Parâmetros de retorno da função (veja observação 5).
| Pos.. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | 2 | alfanumérico | Código de formato comprimido efetuado |
| 3 | 1 | alfanumérico | Tipo de formato comprimido efetuado (I, O ou S) |
| 4 | 2 | alfanumérico | Código do formato expandido efetuado |
| 6 | 1 | alfanumérico | Tipo de formato expandido efetuado (I, O ou S) |
| 7 | 2 | binário | Número de repetições efetuadas |
| 9 | 2 | binário | Deslocamento na área de entrada - retorno (veja observação 2) |
| 11 | 2 | binário | Deslocamento na área de saída - retorno (veja observação 2) |
| 13 | 3 | alfanumérico | Nome do sistema no formato comprimido (veja observação 2) |
| 16 | 1 | alfanumérico | Grupo do sistema no formato comprimido (veja observação 2) |
| 17 | 3 | alfanumérico | Nome do sistema no formato expandido (veja observação 2) |
| 20 | 1 | alfanumérico | Grupo do sistema no formato expandido (veja observação 2) |
## 2.5 Quinto Parâmetro
Área da mensagem de entrada.
| Pos.. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | N | variado | Mensagem a processar (veja observação 4) |
## 2.6 Sexto Parâmetro
Área da mensagem de saída.
| Pos.. | Tam. | Tipo | Descrição |
| --- | --- | --- | --- |
| 1 | N | variado | Mensagem após processamento |
Observações:
1. Se a opção solicitada for "EXP", "ESL", "ESP", "MEX", "MFE" ou "MFN" e for passado “brancos” no código ou tipo de formato comprimido, será expandido ou movido o primeiro formato comprimido encontrado e o código/tipo de formato efetuado será retornado no parâmetro 4.
2. Tamanho dos campos já processados. Na primeira chamada para determinada mensagem, deve ser zero, e nas demais chamadas deve ser passado o valor retornado no quarto parâmetro pela chamada anterior (refere-se ao processamento da mensagem comprimida - param 5).
3. Tamanho Maximo da mensagem expandida. No caso de compressão para envio ao terminal, este valor deverá ser o do tamanho do buffer do terminal.
4. Este parâmetro sempre se refere ao inicio da área, não importando se é o primeiro formato ou não.
5. Campo não utilização na Opção DPC.
6. Na função ESC a área de saída deve conter o caractere # na primeira posição de cada campo que se quer expandir.
### **Tabela de Relação Função x Parâmetros**
| **3º. Parâmetro (entrada)** | **ESC****ESL****ESP****EXP** | **EXM** | **CPS****CRP** | **MGL** | **MEX****MFE****MFN** | **DPC** | **MCF** | **MRP** | **XAT****XML** |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Tamanho máximo área entrada | sim | sim | sim | sim | sim | sim | sim | sim | sim |
| Tamanho máximo área saída | sim | sim | sim | sim | sim | sim | sim | sim | sim |
| Código formato comprimido | sim | sim | sim | - | sim | - | sim | **-** | sim |
| Tipo formato comprimido | sim | sim | sim | - | sim | - | sim | **-** | sim |
| Código formato expandido | sim | sim | sim | - | - | - | - | **-** | **-** |
| Tipo formato expandido | sim | sim | sim | - | - | - | - | **-** | **-** |
| Número de repetições | sim | - | sim | - | - | - | sim | **-** | **-** |
| Deslocamento área entrada | sim | sim | - | sim | sim | - | sim | **-** | sim |
| Deslocamento área saída | - | - | sim | sim | sim | - | sim | **-** | sim |
| Nome do sistema do formato comprimido | sim | sim | sim | **-** | sim | **-** | **-** | **-** | **-** |
| Grupo do sistema do formato comprimido | sim | sim | sim | **-** | sim | **-** | **-** | **-** | **-** |
| Nome do sistema do formato expandido | **-** | **-** | **-** | **-** | **-** | **-** | **-** | **-** | **-** |
| Grupo do sistema do formato expandido | **-** | **-** | **-** | **-** | **-** | **-** | **-** | **-** | **-** |
| Lista de Formatos/Tipos | - | - | - | - | - | - | sim | - | - |
| **4º. Parâmetro (retorno)** | **ESC****ESL****ESP****EXP** | **EXM** | **CPS****CRP** | **MGL** | **MEX****MFE** | **DPC** | **MCF** | **MRP** | **XAT XML** |
| Código formato comprimido | sim | sim | sim | - | sim | **-** | sim | **-** | sim |
| Tipo formato comprimido | sim | sim | sim | - | sim | **-** | sim | **-** | sim |
| Código formato expandido | sim | sim | sim | - | - | - | - | **-** | - |
| Tipo formato expandido | sim | sim | sim | - | - | - | - | **-** | - |
| Número de repetições | sim | - | sim | - | - | - | sim | - | - |
| Deslocamento área entrada | sim | sim | sim | sim | sim | - | sim | - | sim |
| Deslocamento área saída | sim | sim | sim | sim | sim | - | sim | - | sim |
| Nome do sistema do formato comprimido | sim | sim | sim | - | sim | - | sim | - | - |
| Grupo do sistema do formato comprimido | sim | sim | sim | - | sim | - | sim | - | - |
| Nome do sistema do formato expandido | - | - | - | - | - | - | - | - | - |
| Grupo do sistema do formato expandido | - | - | - | - | - | - | - | - | - |
**Legenda**"sim" = indica que o parâmetro é utilizado pela função.
" - " = indica que o parâmetro não faz sentido para a função.
# 3 - Códigos de Retorno
| Código de Retorno | Descrição |
| --- | --- |
| **A** | **Processamento Normal.**Foi completado o processamento solicitado com sucesso. |
| **B** | **Estouro na Área de Entrada.**O tamanho da área de entrada foi atingido e não foi concluído oprocessamento solicitado. Se alguma repetição foi completada, éinformado no parâmetro 4 o número de repetições concluídas |
| **C** | **Estouro na Área de Saída.**O tamanho da área de saída foi atingido e não foi concluído oprocessamento solicitado. Se alguma repetição foi completada, éinformado no parâmetro 4 o número de repetições concluídas. |
| **D** | **Caractere de fim de mensagem comprimida atingida.**O caractere de fim de mensagem comprimida "¬" foi atingido enão foi concluído o processamento solicitado. Se algumarepetição foi completada, é informado no parâmetro 4 o numerode repetições concluídas.**Falta definir o campo DESC na MTNF**Para as opções “XAT” e “XML” está faltando a definição do campoDESC na tabela MTNF. |
| **E** | **Opção Inválida.**A opção solicitada no parâmetro 2 não é nenhuma das permitidas("EXP", "ESL", "CPS", "CRP", "MGL", "MEX", ou "MFE"). |
| **F** | **Formato não consta na Tabela.**O formato solicitado no parâmetro 2 não consta na Tabela deFormatos MTFM (pode ocorrer com as opções "FM", "RP" e"DF"). |
| **G** | **Formato Comprimido Solicitado Diferente do Anterior.**Este return code só será possível na opção "CRP" e o formatopassado no parâmetro 3 não é o mesmo já formatado na área desaída. |
| **H** | **Formato Anterior com Erro.**Não foi encontrado o caractere de término de texto formatado naárea passada para continuar a formatação. |
| **I** | **Tamanho de campo variável inválido.**O tamanho de um campo variável encontrado na mensagem estáinvalido (pode ocorrer com as opções "FM" e "RP"). |
| **J** | **Incompatibilidade entre Área de Entrada e Tabela.**Acabou os campos da área de entrada mas ainda existem camposespecificados na tabela de formato. |
| **K** | **Área Entrada não Inicia com Formato**Quando solicitada movimentação ("MGL", "MEX" ou "MFE") deformato, é esperado no início da área de entrada o início de umformato (caractere especial). Quando não encontrado estecaractere é retornado código "K".(Veja observação no final desta opção). |
| **L** | **Formato Comprimido Inexistente.**O formato comprimido especificado no parâmetro 3 não foilocalizado na tabela de formatos. Verifique se o formato passadoestá na MTNF, com o tipo especificado. |
| **M** | **Formato Expandido Inexistente.**O formato expandido especificado no parâmetro 3 não foilocalizado na tabela de formatos. Verifique se o formato passadoestá na MTFM, com o tipo especificado. |
| **N** | **Nome de Campo não localizado.**O nome de campo existente no formato comprimido e/ouexpandido não foi localizado na tabela de nomes de campos(MTNF). |
| **O** | **Tamanho do campo comprimido maior que máximo.**O tamanho do campo após edição (para movimentar para áreacomprimida), ficou maior que o máximo especificado na tabelade nome de campos (MTNF - parâmetro TAMMAX). |
| **S** | **Sistema não Encontrado – Formato Multissistemas.**Sistema não encontrado, utilizado nas opções “CPS”, “CRP”,“EXM”, “EXP”, “XAT” e “XML”. |
| **Y** | **ERRO no Input (apenas para DPC).**Encontrou caractere de compressão (%), mas o número de bytescomprimido (LL) é inválido. |
| **Z** | **Tamanho da Área de Output insuficiente (apenas para DPC).**Mensagem expandida é maior que o tamanho da área fornecidapara expandi-la. |
| **numérico** | **Erro interno do GRBE.**Este return code é retornado quando o formatador não localizaas informações necessárias para iniciar o processo de formatação.Neste caso deve-se informar o grupo de suporte ao monitor doocorrido.* "1" = problema no endereço da MTFM (opções antigas). * "2" = problema no endereço da Tabela de formatoscomprimidos. * "3" = problema no endereço da Tabela de formatosexpandidos. * "4" = problema no endereço da Tabela de nome decampos. * "6" = código de sistema informado não é processadoneste monitor. * "7" = o terminal não foi encontrado na tabela deformatação do cabeçalho XML. * “8” – erro em subfunção na opção “MCF”. |
| ***Observação***1. No primeiro parâmetro está o código de retorno da ponte "MONITOR" informando o status de processamento da ponte. 2. Os códigos acima retornam no segundo parâmetro. |
| --- |
# 4 - Exemplo
## 4.1 Exemplo de compressão
Temos as seguintes mensagens expandidas:
Formato de Input - I1
| 1111222222 | 00000010000 | 999999 |
| --- | --- | --- |
| ACC | valor | senha |
Formato de Sistema - S1
| 3333444444 | 00000010000 |
| --- | --- |
| ACP | valor |
Na Tabela de Formatos de Output está definido o formato O1 como a seguir:
```
MTBFMO01  FORM=O1,TIPO=O,
          (ACC,ACP),
          'CONSTANTE',
          SENHA,
          VALOR
```
**Resultado da compressão do I1 em O1:**
| ~ | O1 | 01 | @ | 1111222222 | @ | CONSTANTE | @ | 999999 | @ | 10000 | @ | ¬ |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
|  | | | | ACC |  | literal |  | senha |  | valor |  |  |
**Resultado da compressão do S1 em O1:**
| ~ | O1 | 01 | @ | 3333444444 | @ | CONSTANTE | @ | @ | 10000 | @ | ¬ |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
|  | | | | ACP |  | literal |  |  | valor |  |  |
4.2 Exemplo de expansão
Temos as seguintes mensagens comprimidas:
**Formato de Input - I1**
| I1 | 01 | @ | 1111222222 | @ | 999999 | @ | 10000 | ¬ |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
|  | | | ACC |  | senha |  | valor |  |
**Formato de Sistema - S1**
| S1 | 01 | @ | 3333444444 | @ | 10000 | ¬ |
| --- | --- | --- | --- | --- | --- | --- |
|  | | | ACP |  | valor |  |
Na Tabela de Formatos de Output está definido o formato O1 como a seguir:
```
MTBFMO01  FORM=O1,TIPO=O,
          (ACC,ACP),
          VALOR,
          'CONSTANTE',
          (SENHA,'NAOTEM')
```
**Resultado da Expansão do I1 em O1:**
| 1111222222 | 00000010000 | CONSTANTE | 999999 |
| --- | --- | --- | --- |
| ACC | valor | literal | senha |
**Resultado da Expansão do S1 em O1:**
| 3333444444 | 00000010000 | CONSTANTE | NAOTEM |
| --- | --- | --- | --- |
| ACP | valor | literal | literal |
Exemplo de utilização da função XXX
 ## Cobol Exemplo de formatação
Resultado esperado:
```
DATA        HISTORICO                  VALOR
--------   ----------------------   -------------
05/07/91   SALDO ANTERIOR             102.102,00
06/07/91   TEF000122222C                5.000,00
06/07/91   CH COMP 530425              20.000,00
07/07/91   CH COMP 530427                 100,00
07/07/91   SALDO C/C                   77.002,00
```
Definição na Tabela de Formatos:
```
MTBNCP01 NOME=DATA, ---> campo com 6 bytes não editado
 TAMEXP=06,
 MAXCOMP=06,
 EDICAO=X
MTBNCP01 NOME=HIST, ---> campo com 22 bytes suprimidos
 TAMEXP=22, brancos (40) à direita (histor.)
 MAXCOMP=22,
 EDICAO=D,
 CARACT=40
MTBNCP01 NOME=VALOR, ---> campo com 10 bytes suprimidos
 TAMEXP=10, zeros à esquerda (valor)
 MAXCOMP=10,
 EDICAO=E,
 CARACT=F0
MTBFMO01 FORM=FF,TIPO=O, ---> formato de output FF com 3 campos:
 DATA, data, hist e valor
 HIST,
 VALOR
```
**Chamada da Função CPS em Programa Cobol:**
```
....
....
DATA DIVISION
WORKIMG-STORAGE SECTION
....
01 WMONIT1.
 03 FUNCAO PIC X(3).
 03 RETURN-CODE1 PIC X.
 03 ENTIDADE PIC X(8).
....
01 WMONIT2.
 03 OPCAO PIC X(3).
 03 RETURN-CODE2 PIC X.
 03 VERSAO PIC X(8).
....
01 WSOLICIT.
 03 TAM-ENT PIC S9(4) COMP.
 03 TAM-SAI PIC S9(4) COMP.
 03 FORM-C PIC X(2).
 03 TIPO-C PIC X(1).
 03 FORM-E PIC X(2).
 03 TIPO-E PIC X(1).
 03 REPETICOES PIC S9(4) COMP.
 03 DES-ENT PIC S9(4) COMP.
 03 DES-SAI PIC S9(4) COMP.
01 WRETURN.
 03 FORM-C-RET PIC X(2).
 03 TIPO-C-RET PIC X(1).
 03 FORM-E-RET PIC X(2).
 03 TIPO-E-RET PIC X(1).
 03 REPETICOES-RET PIC S9(4) COMP.
 03 DES-ENT-RET PIC S9(4) COMP.
 03 DES-SAI-RET PIC S9(4) COMP.
....
01 WDADENT.
 03 DADOS PIC X(1000).
....
01 WDADSAI.
 03 DADOS-FORM PIC X(512).
....
....
PROCEDURE DIVISION USING ...
....
....
 MOVE 'FMT' TO FUNCAO.
 MOVE 'GRBE' TO ENTIDADE.
 MOVE 'CPS' TO OPCAO.
 MOVE '1' TO VERSAO.
 MOVE 1000 TO TAM-ENT.
 MOVE 512 TO TAM-SAI.
 MOVE 'FF' TO FORM-C.
 MOVE 'O' TO TIPO-C.
 MOVE 'FF' TO FORM-E.
 MOVE 'O' TO TIPO-E.
 MOVE 5 TO REPETICOES.
 MOVE 0 TO DES-ENT.
 MOVE 0 TO DES-SAI.
 CALL 'MONITOR' USING WMONIT1 WMONIT2 WSOLICIT WRETURN WDADENT
WDADSAI.
 IF RETURN-CODE1 = 'A'
 THEN 'ROTINA DE OK'
 ELSE 'ROTINA DE ERRO'.
```
| ***Observação***1. Se houver outras chamadas ao formatador para esta mesma mensagem, deve-se mover o campo "DES-SAI-RET" da chamada anterior para o campo "DES-SAI". Isto possibilitará ao formatador, colocar o resultado da próxima formatação após as mensagens já formatadas na área "DADOS-FORM". |
| --- |
**Dados antes da Formatação (DADOS):**
050791SALDO ANTERIOR 0010210200
060791TEF000122222C 0000500000
060791CH COMP 530425 0002000000
070791CH COMP 530427 0000010000
070791SALDO C/C 0007700200
**Dados após Formatação (DADOS-FORM):**
~FF05@ ---> formato FF ; 05 repetições
050791@SALDO ANTERIOR@10210200@ ---+
060791@TEF000122222C@500000@ | campos dispostos
060791@CH COMP 530425@2000000@ | seqüencialmente
070791@CH COMP 530427@10000@ |
070791@SALDO C/C@7700200@¬ ---+
**Exemplo Repetição de Formato (opção CRP)**
No exemplo acima, se for necessário a inclusão de mais um lançamento logo após os já formatados teremos:
**Lançamento a ser Incluído**
**![](/download/attachments/397200046/image2020-4-17_18-22-44.png?version=1&modificationDate=1587158565000&api=v2)**
**Chamada da Função de Repetição**
```
....
(move novos dados para área de entrada: WDADENT)
....
MOVE 'FMT' TO FUNCAO.
MOVE 'GRBE' TO ENTIDADE.
MOVE 'CRP' TO OPCAO.
MOVE '1' TO VERSAO.
MOVE 1000 TO TAM-ENT.
MOVE 512 TO TAM-SAI.
MOVE 'FF' TO FORM-C.
MOVE 'O' TO TIPO-C.
MOVE 'FF' TO FORM-E.
MOVE 'O' TO TIPO-E.
MOVE 1 TO REPETICOES.
MOVE 0 TO DES-ENT.
MOVE DES-SAI-RET TO DES-SAI.
....
CALL 'MONITOR' USING WMONIT1 WMONIT2 WSOLICIT WRETURN WDADENT WDADSAI.
....
IF RETURN-CODE1 = 'A'
THEN 'ROTINA DE OK'
ELSE 'ROTINA DE ERRO'.
```
```
Dados após Nova Formatação (DADOS-FORM)
~FF06@                                  ---> formato FF ; 06 repetições
050791@SALDO ANTERIOR@10210200@         ---+
060791@TEF000122222C@500000@               | dados já
060791@CH COMP 530425@2000000@             | formatados
070791@CH COMP 530427@10000@               | anteriormente
070791@SALDO C/C@7700200@               ---+
080791@CH COMP 444444@10000@¬        ---> dado formatado agora
```
Observe que o número de repetições passou de 5 para 6 e que o indicador de término da mensagem comprimida foi deslocado para depois da última repetição incluída.