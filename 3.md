---
title: Função JSN - Conversão de protocolos Posicional para Json e Json para Posicional
type: docs
weight: 1
---

     
# 1 - Descrição e Conceitos
     
O processo de formatação consiste na transformação de dados da forma Posicional para o formato Json e/ou vice-versa.
Este processo é comandado pela aplicação sob GRBE através de uma chamada à ponte "MONITOR", o GRBE utiliza tabelas com as especificações de cada campo da mensagem e a relação de campos que compõem um determinado formato.
     
## Utilização da Ponte Monitor
     
A ponte monitor faz a interface do programa de aplicação com o programa formatador que tem as funções básicas para a conversão nos formatos desejados.
     
## Mensagem Posicional
     
A mensagem posicional deve ser uniforme, espelhando o que está cadastrado na tabela que o GRBE irá usar para fazer a conversão desejada.
     
# 2 - Tabela de Nomes e Formatos.
     
No processo de formatação é necessário uma tabela fornecida pela aplicação, onde há as especificações dos nomes, características dos campos e seus formatos, (Tabela de Posicional para Json ou Json para Posicional).
Está tabela deve ser cadastra como um programa na MTMO, esta deve estar cadastrada com o TIPO=TAB.
Esta tabela é composta por 2 sub-tabelas, a tabela que contem os dados de Json para Posicional e a tabela com os dados de Posicional para Json geradas a partir de uma única macro:
**- MIBJSNXX**– Gera tabela de Nomes de Campos.
     
# 3 - Opções Disponíveis
     
Através da ponte "MONITOR", um aplicativo poderá chamar o formatador com uma das opções descritas a seguir:
+ **J2P – CONVERSÃO DE JSON PARA POSICIONAL*+
Está função é solicitada pela aplicação para transformar uma mensagem que está no formato Json para o formato posicional, após a formatação a mensagem POSICIONAL estará na área de mensagem informada pela aplicação, seguindo as especificações da tabela fornecida pela aplicação.
+ **SCH – SUB-FUNÇÃO SEARCH.**
Com está sub-função é possível procurar na mensagem da aplicação se há o objeto que se deseja trabalhar.
+ **PAR – SUB-FUNÇÃO PARSE.**
Com está sub-função é possível validar se a sintaxe da mensagem está correta.
+ **FOR – SUB-FUNÇÃO FORMATAÇÃO.**
Está função é utizada para formatar a mensagem Json passada para o GRBE para o formato Posicional. O GRBE consulta a tabela da aplicação para fazer a conversão.
+ **P2J – CONVERSÃO DE POSICONAL PARA JSON*+
Está função é solicitada pela aplicação para transformar uma mensagem que está no formato posicional para o formato Json, após a formatação a mensagem Json estará na área de mensagem informada pela aplicação, seguindo as especificações da tabela fornecida pela aplicação. Pra está opção, não há sub-funções.
     
# 4 - Descrição dos Parâmetros
     
O aplicativo devera chamar a função "JSN" através da ponte "MONITOR", passando os seguintes parâmetros:
     
## 4.1 Primeiro Parâmetro
     
Parâmetros da Ponte Monitor

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **3 BYTES** | Função "JSN" |
| **1 BYTE** | Return-Code da Ponte |
| **8 BYTES** | Entidade (Fixo "GRBE") |
<!-- Tabela Fim -->

     
## 4.2 Segundo Parâmetro
     
Opções para chamada.

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **3 BYTES** | Opção da chamada (Fixo: 3 Bytes J2P ou P2J). |
| **1 BYTE** | Return code da chamada. |
| **3 BYTES** | Sub-função se houver. (For,par ou sch para J2P) (nada para P2J). |
| **6 BYTES** | Tabela da aplicação que será utilizada para conversão. |
| **10 BYTES** | Qual a entrada da tabela que será utilizada para conversão. |
| **4 BYTES** | Tamanho da mensagem de entrada |
| **4 BYTES** | Tamanho da mensagem de saída “retorno do subprograma” |
| **4 BYTES** | Tamanho do buffer de entrada |
| **4 BYTES** | Tamanho do buffer de saída |
<!-- Tabela Fim -->

     
## 4.3 Terceiro Parâmetro
     
Areá de INPUT endereço de onde está a mensagem a ser formatada, e o tamanho da mensagem que será formatada. Para a opção J2P, o tamanho do input não pode ser superior a 30k. Utilizar o codepage 00924 na mensagem no entanto se seu INPUT não estiver com o codepage correto, utilizar a função CNV da ponte monitor para converte-lo.

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **N BYTES** | AREA DE ENTRADA DA MENSAGEM |
<!-- Tabela Fim -->

     
## 4.4 Quarto Parâmetro
     
Area de OUTPUT onde o GRBE informara o tamanho da mensagem formatada, e a mensagem formatada.

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **N BYTES** | AREA DE RESPOSTA |
<!-- Tabela Fim -->

     
## 4.5 Quinto Parâmetro
     
Area de retorno para erros.

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **136 BYTES** | Nesta área o GRBE irá mover mensagens de erro, como objeto não encontrado, erro de sintaxe do Json. |
| **50 BYTES** | Campo que ocorreu o erro. |
<!-- Tabela Fim -->

     
# 3 - Códigos de Retorno
     
Código de Retorno, Return Code e Reason Code.

<!-- Tabela Início -->
|     |     |     |
| --- | --- | --- |
| **RC** | **RS** |  |
| **A** | **A** | Processamento Normal. Foi completado o processamento solicitado com sucesso. |
| **A** | **B** | Tamanho passado no campo da tabela, é menor do que o tamanho do campo do JSON. |
| **A** | **C** | Função invalida |
| **A** | **D** | Tipo cadastrado na tabela é diferente do Json |
| **A** | **E** | Formato solicitado não encontrado |
| **A** | **F** | Erro ao fazer a chamada a tabela |
| **A** | **H** | Erro ao realizar o preenchimento |
| **A** | **I** | Erro na função Get Num (HWTJGNUE) |
| **A** | **J** | Erro na função Get Array (HWTJGAEN) |
| **A** | **K** | Erro na função Get Object (HWTJGOEN) |
| **A** | **M** | Ocorrências cadastrado na tabela menor que Ocorrências no Json |
| **A** | **N** | Objeto não encontrado no Array |
| **A** | **O** | Endereço de Input zerado |
| **A** | **P** | Erro na função Pars (HWTJPARS) |
| **A** | **Q** | Tamanho do Input zerado |
| **A** | **R** | End do output esta zerado |
| **A** | **S** | Erro na função Search (HWTJSRCH) |
| **A** | **T** | Erro na função Type (HWTJGJST) |
| **A** | **V** | Erro na função Value (HWTJGVAL) |
| **A** | **U** | Estouro no buffer output |
| **A** | **V** | Erro na função value |
| **A** | **X** | Parametro passado zerado |
| **A** | **W** | Sem Work para MILINK |
| **B** |  | Função passada não foi encontrada. Função solicitada diferente de “P2J” “J2P”. Não há reason code. |
| **C** |  | Erro na função “sub” ponte monitor no Reason code vem o erro da ponte monitor. |
| **D** | **M****N****V****Y** | Erro na chamada ao programa formatador. Erro na função “Sub” para o programa de formatação.**M** – O subprograma chamado não está catalogado.**N** – O subprograma foi catalogado indevidamente, ou seja, todo subprograma Cobol reentrante deve ser catalogado com AMODE acima dos 16Mb.**V** – O subprograma chamado está inativo ou a carga dos subprogramas ainda não terminaou ( neste ultimo caso a execução se normaliza assim que a inicialização do GRBE terminar).**Y** – A MTSP não foi encontrada. |
| **D** | **D** | Erro na execução do programa formatador. |
| **E** |  | Função “JSN” indisponível. |
| **A** | **G** | Cadastro de Array dentro de Array, na tabela, incorreto. |
| **A** | **Y** | Erro no INIT JSON PASER (opção J2P). |
| **A** | **Z** | Tamanho do input maior do que 30k (opção J2P). |
<!-- Tabela Fim -->


<!-- Tabela Início -->
|     |
| --- |
| **Observação****1.** No primeiro parâmetro está o código de retorno da ponte "MONITOR" informando o status de processamento da função jsn.**2.** Quando o retorno da ponte “MONITOR” é A, no Reason Code vem o código de erro do sub-programa de formatação.**3.** Quando o retorno da ponte “MONITOR” é diferente de A, no Reason Code vem o código de erro das chamadas a ponte monitor internamente no GRBE.**4.** Caso ocorra algum erro durante o processamento o GRBE limpara a área de output, onde estará a mensagem já formatada. |
<!-- Tabela Fim -->

     
# 4 - Exemplos
     
```
        DATA   DIVISION
        *** AREA PARA A PONTE MONITOR ***
        01  WMONIT.
        03  WMONIT-FUN          PIC   X(03).
        03  WMONIT-RC           PIC   X(01).
        03  WMONIT-ENT          PIC   X(08).
        *** AREA PARA FUNCAO JSN - PARAM 2 ***
        01  WPARAM2.
        03  WPARAM2-FUN         PIC   X(03).
        03  WPARAM2-RC          PIC   X(01).
        03  WPARAM2-OPC         PIC   X(03).
        03  WPARAM2-TAB         PIC   X(06).
        03  WPARAM2-LAY         PIC   X(10).
        03  WPARAM2-TAM-INP     PIC   S9(8)USAGE BINARY.
        03  WPARAM2-TAM-OUT     PIC   S9(8)USAGE BINARY.
        03  WPARAM2-BUF-INP     PIC   S9(8)USAGE BINARY.
        03  WPARAM2-BUF-OUT     PIC   S9(8)USAGE BINARY.
        *** AREA PARA INPUT - LTRANS - PARAM 3 ***
        01  WPARAM3.
        03  WPARAM3-JSN-VAR       PIC   X(30000).
        *** AREA PARA OUTPUT - LRESP - PARAM 4 ***
        01  WPARAM4.
        01  WPARAM4-JSN-VAR       PIC   X(30000).
        *** AREA DE ERRO -  PARAM 5 ***
        01  WPARAM5.
        03  WPARAM5-JSN-ERR       PIC   X(136).
        03  WPARAM5-JSN-NME       PIC   X(30).
```
```
        PROCEDURE
        *** CHAMADA DA FUNCAO ***
        MOVE   'JSN'            TO  WMONIT-FUN.
        MOVE   ' '              TO  WMONIT-RC.
        MOVE   'GRBE'           TO  WMONIT-ENT.
        MOVE   'P2J'            TO  WPARAM2-FUN.
        MOVE   '   '            TO  WPARAM2-OPC.
        MOVE   'MITBXX'         TO  WPARAM2-TAB.
        MOVE   'ENTRADA001'     TO  WPARAM2-LAY.
        MOVE   ' '              TO  WPARAM2-RC.
        MOVE   '30000'          TO  WPARAM2-BUF-OUT.
        CALL   'MONITOR'    USING    WMONIT WPARAM2 WPARAM3 WPARAM4 WPARAM5
        IF   WMONIT-RC      NOT EQUAL  'A'
          OR   WPARAM2-RC     NOT EQUAL  'A'
               PERFORM        ROTERRMO.
        * VALORES QUE ESTARIAM NO WPARAM3 APOS A CHAMADA DA PONTE *
          * DE ACORDO COM O EXEMPLO CITADO ACIMA.                   *
        LRESP
        WPARAM4-JSN-TAM ---> (Tamanho da resposta)
        WPARAM4-JSN-END ---> (Resposta no formato requerido)
        WPARAM5-JSN-ERR ---> (Descrição do erro ocorrido)
        WPARAM5-JSN-NME ---> (Nome do campo que ocorreu o erro)
```