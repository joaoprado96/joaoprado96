---
title: Função STM – Start de Transação
type: docs
weight: 1
---

     
# 1 - Descrição e Conceitos
     
Função onde o aplicativo solicita ao GRBE o "start" de uma transação.
     
# 2 - Descrição dos Parâmetros
     
     
## 2.1 Primeiro Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 3 Bytes | Função da PONTE MONITOR que está sendo solicitada: “STM” |
| 1 Byte | Código de retorno da PONTE MONITOR. |
| 3 Bytes | Nome da entidade que tratará a função: “GRBE”. |
<!-- Tabela Fim -->

     
## 2.2 Segundo Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 3 Bytes | Tipo de start solicitado:"IME" = start imediato. |
| 1 Byte | Código de retorno da função. |
| 3 Bytes | Deve conter nos 6 primeiros bytes, o tipo de terminal de transações startadas: "070100". Para tipos “IME” ou “TMP” e sem preenchimento para tipo “GER" |
<!-- Tabela Fim -->

     
## 2.3 Terceiro Parâmetro
     
Layout para tipo “IME” ou “TMP”

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **(n + 2) bytes** | Dados de input para a transação.Terá exatamente o layout de uma mensagem enviada por um terminal, como no layout a seguir. |
<!-- Tabela Fim -->


<!-- Tabela Início -->
|     |     |     |     |     |     |     |     |     |     |     |     |     |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **Tam.** | A | B | C | D | E | F | G | H | I | J | ...X | Y ...Z |
| **2** | n bytes | | | | | | | | | | | |
<!-- Tabela Fim -->


<!-- Tabela Início -->
|     |     |     |
| --- | --- | --- |
| **Campo** | **Tamanho (bytes)** | **Descrição** |
| **Parte Fixa** | | |
| **tam** | 2 | Tamanho dos dados de input, isto é “n” bytes. |
| **A** | 1 | Versão do protocolo (“2”) |
| **B** | 3 | Deve conter brancos (corresponde a entrada no concentrador). |
| **C** | 1 | Comando de START de transação (“N”). |
| **D** | 4 | Número seqüencial da MSG – livre (1). |
| **E** | 6 | Código da instituição destino da transação a ser startada. (2) |
| **F** | 4 | Código da agência destino da transação a ser startada. (2) |
| **Parte do Header (descrita na MTHD para o terminal tipo 0701).** | | |
| **G** | 3 | Tempo de resposta da última transação – livre (1). |
| **H** | 8 | Código da transação a ser startada |
| **I** | 8 | Nome do programa que está pedindo a função STM |
| **J** | 2 | Código do formato. |
| **... X** |  | Demais campos descritos no HEADER. |
| **Parte Variável** | | |
| **Y ... Z** |  | Campos da “parte variável” do aplicativo |
<!-- Tabela Fim -->

Observação
1. Estes campos são controlados totalmente pelo aplicativo. O GRBE apenas grava estas informações no arquivo de estatística por compatibilidade.
2. Na solicitação de start tipo imediato (IME), a instituição e agência destino podem pertencer a qualquer monitor GRBE com código de sistema igual ao do monitor onde está sendo feita a solicitação. O start por tempo só pode ser solicitado para execução no mesmo monitor. Em nenhum caso é permitido o start para execução em monitor de outro sistema.
**Layout para tipo “GER” ou “TGI”**

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **Tamanho** | **Descrição** |
| **2** | Tamanho dos dados de input, isto é “n” bytes. |
| **1** | “G” para retorno à transação startante em caso de erro, ou “J” – sem retorno em caso de erro. |
| **3** | Deve conter a transação a ser startada |
| **1** | Deve conter 0 ou o passo da transação a ser startada |
| **4** | Zeros ou o complemento da transação a ser startada. |
| **6** | Código da instituição destino da transação a ser startada. (1) |
| **4** | Código da agência destino da transação a ser startada. (1) |
| **N** | “n” bytes - dados e serem entregues na Ltrans da transação a ser startada. |
<!-- Tabela Fim -->

**Layout para tipo “TGC”**

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **Tamanho** | **Descrição** |
| **2** | Tamanho dos dados de input, isto é “n” bytes. |
| **6 bytes** | HHMMSS da solicitação do START |
| **8 bytes** | Chave a ser cancelada |
<!-- Tabela Fim -->

Observação
1. Na solicitação de start tipo GER, a instituição e agência destino precisam pertencer ao mesmo monitor onde está executando a transação startante. Não é permitido start GER para outro monitor.
2.4 Quarto Parâmetro
Utilizado apenas para "start por tempo" (tipo “TMP”).

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **12 bytes** | Data e horário em que a transação deve ser "startada".Preencher este campo no formato DDMMAAHHMMSS. |
| **4 bytes** | Em branco.Neste campo o GRBE devolverá um identificador para cada solicitação. |
<!-- Tabela Fim -->

Utilizado apenas para "start por tempo" (tipo “TGI”).

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **12 bytes** | Data e horário em que a transação deve ser "startada".Preencher este campo no formato DDMMAAHHMMSS. |
| **8 bytes** | Em branco.Neste campo o GRBE devolverá um identificador para cada solicitação. |
<!-- Tabela Fim -->

     
# 3 - Códigos de Retorno
     
O código de retorno da função STM vem no quarto byte do segundo parâmetro, e pode ter os seguintes valores:

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **Código de Retorno** | **Descrição** |
| **A** | Processamento nromal. A transação foi startada. |
| **B** | Comando de "start" de transação (no terceiro parâmetro) inválido. Diferente de "N" |
| **C** | Agência destino (no terceiro parâmetro) inválida. Agência solicitada para processar a transação é inválida (não consta na tabela MTER ou consta associada a um monitor não permitido”). |
| **D** | Excedeu limite de starts. O aplicativo solicitou "999" starts por tempo para o mesmo horário (possível loop da aplicação). |
| **E** | Excedeu limite de starts imediatos pendentes. |
| **F** | A comunicação entre o monitor que solicitou o start e seu auxiliar não está ativa. |
| **G** | Erro de gravação no arquivo STEMPKSD ou STEMPRRD. Foi solicitado um "start por tempo" e ocorreu erro no processo de gravação de dados nos arquivos que controlam esse tipo de "start"; portanto, a transação não será startada. Verificar no log o motivo do erro através da mensagem TRMP.911E. |
| **I** | Sem comunicação entre a applid auxiliar (usada para start) e a principal. Verificar o status da sessão com o comando CON,ID=xxxx ou CON,ID=AUX. Se necessário, ativar a sessão através do comando ATIV,CON,ID=AUX ( se foi num start para o mesmo monitor) ou ATIV,CON,ID=xxxxx ( se foi start para o monitor xxxxx) |
| **J** | Não há task disponível para processar o pedido. |
| **K** | Parâmetros passados são inválidos. |
| **L** | Erro interno do GRBE. Ocorreu erro na linkage inicial. Comunicar ao grupo de suporte ao GRBE. |
| **P** | Erro interno do GRBE. O monitor GRBE não encontrou endereço da MTER ou não encontrou o applid na tabela de monitores. Comunicar ao grupo de suporte ao GRBE. |
| **Q** | Start de transações por tempo está inativo. Foi solicitado um "start por tempo" porém o processo para esse tipo de "start" está inativo. Através de mensagens no log pode-se determinar o que causou a inativação (MNTO943 ou MCST000). |
| **S** | Erro interno do GRBE. Erro no send da applid auxiliar para a principal. Comunicar ao grupo de suporte ao GRBE |
| **T** | Erro interno do GRBE. Número de tentativas de send ultrapassou o definido na tabela MTCT (campo QTSD). |
| **U** | Erro interno do GRBE. Task em processo de “detach”. Comunicar ao grupo de suporte ao GRBE |
| **V** | Data ou horário expirado. A data ou horário passados pela aplicação para "start por tempo", já expiraram. A transação não será startada; pode-se solicitar novamente. |
| **X** | Data ou horário inválidos. A data ou horário passados pela aplicação para "start por tempo", são inválidos. A transação não será startada; solicite novamente com data/horário dentro do padrão definido (DDMMAAHHMMSS). |
| **Z** | Função inválida. Tipo de start solicitado Inválido (segundo parâmetro) |
<!-- Tabela Fim -->

**Observação:**
Os return codes "P" e "Z" descritos acima são da função STM. Não confundir com os return codes da ponte MONITOR, válidos para todas as funções, mas com significado diferente.
     
# 4 - Chamada no Formato Antigo
     
 Os parâmetros descritos abaixo ainda são aceitos apenas por compatibilidade com aplicações antigas. Mas é recomendável utilizar os parâmetros conforme descritos no item 2.
     
## 4.1 - Parâmetros da Chamada Antiga
     
     
### 4.1.1 - Primeiro Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **3 bytes** | Função da PONTE MONITOR que está sendo solicitada: “STM”. |
| **1 byte** | Código de retorno da PONTE MONITOR. |
| **8 bytes** | Nome da entidade que tratará a função: “GRBE”. |
<!-- Tabela Fim -->

     
### 4.1.2 - Segundo Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **3 bytes** | Tipo de ativação solicitada:"**IME**" = start imediato."**TMP**" = start por tempo (este tipo requer quarto parâmetro). |
| **1 byte** | Código de retorno da função. |
| **8 bytes** | Deve conter nos 6 primeiros bytes, o tipo de terminal.Inicialmente está definido como "**070100**". |
<!-- Tabela Fim -->

     
### 4.1.3 - Terceiro Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **(n + 2)bytes** | Dados de input para a transação.Terá exatamente o layout de uma mensagem enviada por um terminal, ou seja, terá o seguinte formato (\*). |
<!-- Tabela Fim -->

     
### 4.1.4 - Formato (\*)
     

<!-- Tabela Início -->
|     |     |     |     |     |     |     |     |     |     |     |     |     |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **Tam.** | A | B | C | D | E | F | G | H | I | J | ...X | Y ...Z |
| **2** | n bytes | | | | | | | | | | | |
<!-- Tabela Fim -->


<!-- Tabela Início -->
|     |     |     |
| --- | --- | --- |
| **Campo** | **Tamanho (bytes)** | **Descrição** |
| **Parte Fixa** | | |
| **tam** | 2 | Tamanho dos dados de input, isto é “n” bytes. |
| **A** | 1 | Comando de START de transação ("N") |
| **B** | 1 | Deve conter brancos (corresponde a entrada no concentrador). |
| **C** | 2 | Deve conter brancos (corresponde a quantidade de erros de transmissão). |
| **D** | 4 | Número seqüencial da MSG (\*). |
| **E** | 4 | Código da agência destino da transação a ser ativada. |
| **Parte do Header (descrita na MTHD).** | | |
| **F** | 3 | Tempo de resposta da última transação (\*). |
| **G** | até 8 | Código da transação a ser ativada/startada. |
| **H** | até 8 | Nome do programa "startante" (número físico do terminal). |
| **I** | 2 | Código do formato. |
| **... X** |  | Demais campos descritos no HEADER. |
| **Y ... Z** |  | Campos da “parte variável” do aplicativo |
<!-- Tabela Fim -->

**Observação**
 Os campos marcados com (\*) serão controlados totalmente pelo aplicativo. O GRBE basicamente gravará estas informações no estatística por questões de compatibilidade.
     
### 4.1.5 - Quarto Parâmetro
     
 Utilizado apenas para "start por tempo".

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **12 bytes** | Data e horário que a transação deve ser "startada".Preencher este campo no formato DDMMAAHHMMSS. |
| **4 bytes** | Em branco.Neste campo o GRBE devolverá um identificador para cada pedido. |
<!-- Tabela Fim -->
