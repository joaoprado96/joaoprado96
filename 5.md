---
title: Função HTP - Requisição à APIs na Cloud
type: docs
weight: 1
---

     
# 1 - Descrição e Conceitos
     
Função para as aplicações rodando sob o GRBE fazerem requisição a APIs na Cloud.
Exemplo de chamada a função “HTP”:
![](/download/attachments/391816208/image2020-5-8_19-22-52.png?version=1&modificationDate=1588976573000&api=v2)
     
# 2 - Descrição dos Parâmetros
     
     
## 2.1 Primeiro Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 3 bytes | Função da PONTE MONITOR que está sendo solicitada: "**HTP**" |
| 1 byte | Código de retorno da PONTE MONITOR. |
| 8 bytes | Nome da entidade que tratará a função: "**GRBE**". |
<!-- Tabela Fim -->

     
## 2.2 Segundo Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 3 bytes | Opção solicitada; pode ser: * "**API**" = Request tipo API. |
| 1 byte | Código de retorno da opção. |
| 8 bytes | Request Method – "POST", "GET", "PUT", "PATCH" ou "DELETE" |
<!-- Tabela Fim -->

     
## 2.3 Terceiro Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 8 bytes | Nome da conexão |
| 8 bytes | Código da transação a ser startada com dados do responseObs. Caso este campo esteja em branco ou com zeros binários, a função retornará erro com RC="C". |
| 30 bytes | Chave para salva e restaurar o contexto – gerada pela aplicação |
| 2 bytes | Tamanho do ENDPOINT (Binario) |
| nn bytes | ENDPOINT – Caminho da API dentro do servidor (Opcional)Obs. Caso este campo esteja com zeros binários, será assumido o ENDPOINT definido na tabela MITBH1. |
| 36 bytes | client\_id - Credencial que será utilizada pela aplicaçãoObs: Caso este campo esteja com zeros binários, ou brancos, será assumido que a aplicação não deseja autenticação no STS e não será montado nenhum header de Authorization. |
<!-- Tabela Fim -->

Exemplo de criação do terceiro parâmetro:
![](/download/attachments/391816208/image2020-5-8_19-24-32.png?version=1&modificationDate=1588976673000&api=v2)
     
## 2.4 Quarto Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 2 bytes | Quantidade de Itens de Header (Binario) |
| 2 bytes | Tamanho do Item de Header + Valor do Item (Repete N Vezes)(Tamanho máximo: 32.767 bytes) |
| nn bytes | Item de Header + Valor do Item |
<!-- Tabela Fim -->

Exemplo de criação de Header:
![](/download/attachments/391816208/image2020-5-8_19-25-3.png?version=1&modificationDate=1588976704000&api=v2)
     
## 2.5 Quinto Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 2 bytes | Quantidade de Bodys |
| 2 bytes | Tamanho do Body (Binario)(Tamanho máximo: 32.767 bytes) |
| Nn bytes | Body Request |
<!-- Tabela Fim -->

Os dados do Body podem ser em qualquer formato, texto, json, xml e etc, conforme regras do protocolo HTTP.
     
## 2.6 Sexto Parâmetro
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| 4 bytes | Code page de saída (BINÁRIO) |
<!-- Tabela Fim -->

Esse campo deverá conter o codepage que o body estará formatado quando for devolvido pelo GRBE.
Caso o campo esteja com 0s binários, o GRBE devolverá o que veio da API, sem formatação nenhuma.
O Codepage EBCDIC que recomendamos é o 924. O ASCII é o 1208.
Em caso de codepage inválido (ex:55555), o GRBE devolverá o return code R (Erro de conversão) e devolverá a resposta que veio da API, sem formatação nenhuma.
É importante saber que, em caso de return code R, o status code deverá ser validado para saber se a requisição foi sucesso ou não.
Exemplo de definição do parâmetro:
![](/download/attachments/391816208/image2023-6-30_9-1-45.png?version=1&modificationDate=1688126505000&api=v2)
     
# 3 - Códigos de Retorno
     

<!-- Tabela Início -->
|     |     |
| --- | --- |
| **Código de Retorno** | **Descrição** |
| **A** | Processamento normal. |
| **B** | Não há tasks de comunicação HTTP disponíveis, provável lentidão no retorno das APIs ou conexões HTTPCON inativadas. |
| **C** | Request Method Inválido ou o parâmetro de transação a ser startada não foi passado. |
| **D** | Erro na Alocação de áreas no momento do Request, antes da montagem do Header. |
| **E** | Erro na montagem do Header, antes da montagem do Body. |
| **F** | Erro na montagem do Header, header total maior que 32k. |
| **G** | Erro na montagem do Body. |
| **H** | Erro na montagem do Body, conversão de EBCDIC para UTF-8 com erros |
| **I** | (Descontinuado) Erro na montagem do Header, conversão de EBCDIC para UTF-8 com erros |
| **J** | Erro na montagem do BODY, Body total maior que 32k |
| **K** | Erro na configuração do Request, após montagem do body. |
| **L** | Tamanho do end point passado pela função HTP está zerado. |
| **M** | Sub função (API) passada inválida para função HTP da ponte monitor. |
| **N** | Conexão passada com nome inválido. |
| **O** | Aplicação tentou passar um header igual ao header de infra do GRBE |
| **P** | Erro no processo da THPS e duas TRMP estão tentando postar a mesma THPS |
| **R** | Erro de conversão no Request (A partir da 84F) |
| **S** | Token ainda não disponível para utilização |
| **U** | Houve timeout ao estabelecer conexão |
| V | NAO ENCONTROU A CREDENCIAL NA TABELA |
| **W** | Erro grave na obtenção do token RC=08 que gerou suspensão da task |
| **Y** | Erro na obtenção do token RC=04 deixa a task em wait |
| **X** | O Client\_id passado pela aplicação não foi encontrado na tabela de credenciais. |
| **Z** | Abend na THPS |
<!-- Tabela Fim -->

     
# 4- Resposta do Request
     
Após o Request ser feito, o GRBE irá chamar outra transação com informações no LTRANS da mesma.

<!-- Tabela Início -->
|     |     |     |
| --- | --- | --- |
| Deslocamento | Tamanho | Informação |
| 0 | 1 | Return Code do RequestA = Tentativa de Request OKC = Tamanho do body está zerado após o Request (será alterado na 84F)E = Erro na configuração do retry (será alterado na 84F)F = Erro grave no retry (será alterado na 84F)G = Erro genérico no Request (será alterado na 84F)H = Erro de conversão no Request (será alterado na 84F)I = Tamanho do body está zerado após o Request (A partir da 84F)O = Erro na configuração do retry (A partir da 84F)P = Erro no processo da THPS e duas TRMP estão tentando postar a mesma THPSQ = O Client\_id passado pela aplicação não foi encontrado na tabela de credenciais.R = Erro de conversão no Request (A partir da 84F)T = Houve timeout na requisiçãoX = O Client\_id passado pela aplicação não foi encontrado na tabela de credenciais.Z = Houve ABEND na requisição |
| 1 | 4 | Status Code (Servidor) |
| 5 | 30 | Chave de Recuperação de Contexto |
| 35 | 136 | DIAGAREA retornada do Request ([link](https://www.ibm.com/docs/en/zos/2.4.0?topic=enabler-syntax-linkage-programming-considerations))**HWTH\_Service (bytes 0 - 4):** A 4-byte constant value that indicates which internal service invoked by the toolkit detected the possible error. To determine which service, consult the first two bytes of this field and locate that value in the defined service constants provided in the IDFs (include files).**HWTH\_ReasonCode (bytes 5 -8):** A specific error code returned by the internal service identified by HWTH\_Service. This can be useful in determining the reason why a particular service failed.**HWTH\_ReasonDesc (bytes 9 - 136):** A 128-character field that contains a more detailed description of the problem. In many cases, this information is sufficient to determine the cause of the problem. In some cases, additional information is also provided here that you can provide to IBM Support if you cannot determine the problem after using the other problem determination techniques described here. |
| 172 | 8 | Transação que será startada na volta |
| 179 | 2 | Tipo de terminal da transação |
| 172 | 20 | Filler - Não estão sendo utilizados os bytes entre o final da diagarea e ínicio do Header |
| 200 | 4 | Quantidade de Headers |
| 204 | 2992 | Header ResponseSegue a regra a seguir: |
| 3196 | 4 | Tamanho do Body Response |
| 3200 | ? | Body Response |
<!-- Tabela Fim -->
